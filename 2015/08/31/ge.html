<!DOCTYPE html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags --><meta name=apple-mobile-web-app-capable content=yes><link rel="shortcut icon" href=favicon.ico><link rel=apple-touch-icon href=apple-touch-icon.png><link type=application/atom+xml rel=alternate href=https://www.harshadparanjape.com/feed.xml title="harshadparanjape.com"><!-- Page metadata for Google, Facebook, Twitter --><meta property=dc:title content="Processing GE2 Diffraction Images using ImageMagick"><meta property=dc:creator content="Harshad Paranjape"><meta property=dc:format content="text/html"><meta property=dc:language content="en"><meta property=dc:identifier content="/2015/08/31/ge.html"><meta property=dc:rights content="All rights reserved."><meta property=dc:source content=""><meta property=dc:type content="website"><meta property=og:title content="Processing GE2 Diffraction Images using ImageMagick"><meta property=og:type content=website><meta property=og:url content=https://www.harshadparanjape.com/2015/08/31/ge.html><meta property=og:image content=https://www.harshadparanjape.comfavicon.ico><meta property=og:description content="Amorphous Si area detectors manufactured by GE are currently used at APS and CHESS to acquirefar-field high-energy X-ray diffraction data. The data from such..."><meta property=og:site_name content=harshadparanjape.com><meta property=og:locale content=en_US><meta property=article:modified_time content=2015-08-31T05:17:30-07:00><meta property=article:published_time content=2015-08-31T05:17:30-07:00><meta property=article:section content=science><meta name=twitter:card content=summary><meta name=twitter:site content=@hmparanjape><meta name=twitter:creator content=@hmparanjape><meta name=twitter:title content="Processing GE2 Diffraction Images using ImageMagick"><meta name=twitter:description content="Amorphous Si area detectors manufactured by GE are currently used at APS and CHESS to acquirefar-field high-energy X-ray diffraction data. The data from such..."><meta name=twitter:image content=https://www.harshadparanjape.comfavicon.ico><meta name=twitter:url content=https://www.harshadparanjape.com/2015/08/31/ge.html><link rel=icon href=../../../favicon.ico><title>Processing GE2 Diffraction Images using ImageMagick</title><link rel=stylesheet href=../../../css/main.css><script src=../../../js/head-scripts.js></script><!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --><!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]--></head><body><div class=navbar><div class=container><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#navbar aria-expanded=false aria-controls=navbar><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <span class=navbar-brand><a href="../../../">Harshad Paranjape</a> | Blog</span></div><div id=navbar class="collapse navbar-collapse"><ul class="nav navbar-nav pull-right"><li><a href=../../../research.html>Research</a></li><li><a href=../../../blog.html>Blog</a></li><li><a href=mailto:hi@hm.paranja.pe><span class=hp-nav-email>Email</span></a></li></ul></div><!--/.nav-collapse --></div></div><!-- Container --><div id=hp-blog-empty-top></div><div class="container hp-blog"><div class=row><div class="col-md-10 hp-blog-post-heading"><h1>Processing GE2 Diffraction Images using ImageMagick</h1><div class=hp-blog-subtitle><p class="hp-blog-subtitle-item small">August 31, 2015</p></div></div></div><div class=row><div class="col-md-10 hp-blog-post"><p><img src=https://www.harshadparanjape.com/img/hp-blog-splash-ge.png alt="GE image processing using ImageMagick" title="A representative diffraction image."></p><p>Amorphous Si area detectors manufactured by GE are currently used at APS and CHESS to acquire far-field high-energy X-ray diffraction data. The data from such detectors is stored in multi-frame, 16-bit depth binary images with 8192 bytes of header data. The data files typically have an extension <code>.ge2</code>. Since ImageMagick is able to deal with raw binary images like any other image format, it is possible to easily manipulate ge2 files using the <code>convert</code> command-line utility. I have written <a href=https://gist.github.com/hmparanjape/ef50c999d7fd69c3e996>a gist</a> that shows some simple ways of processing GE2 images using ImageMagick.</p><!--more--><noscript><pre># Miscellaneous Diffraction Image Processing Commands # This file defines aliases for several common image processing # functions for GE2 diffraction images. This uses ImageMagick # program, which is typically available on all Linux and Mac # systems - http://www.imagemagick.org/script/index.php # USAGE: # Copy the contents of this file to the bottom of ~/.bashrc # Run from terminal: source ~/.bashrc # After this, following commands should be available # 1. Convert TIFF to GE. Saves input.ge2 # tiff2ge input.tiff # 2. Convert GE to TIFF. Saves input.tiff (Note: The produced TIFF may seem to have very low # intensity. That is because, GE2 has 16-bit depth. So the intensity # can go from 0 to 65000. Detectors at APS and CHESS generally max out # at 16000 counts. So even high intensity points have only 25% intensity. # You can stretch the intensity range of the TIFF using ImageMagick - # convert -normalize original.tiff bright_output.tiff). If the GE2 file has # multiple frames, TIFF is multipage. You can split TIFF into individual frames # using - convert multipage.tiff frame_%05d.tiff # ge2tiff input.ge2 # 3. Maximum over frames (saves a single frame with maximum intensity. Name: input-max.[ge2 | tiff]) # max_over_frames input.[ge2 | tiff] # 4. Mean over frames (saves a single frame with mean intensity. # Good for creating a dark frame from a sequence. Name: input-mean.[ge2 | tiff]) # mean_over_frames input.[ge2 | tiff] # 5. Extract a single frame from a multi-frame image. Saves multiframe_frame_num.[ge2 | tiff] # extract_frame multiframe.[ge2 | tiff] frame_num # 6. Subtract dark frame from a (single or multi-frame) image. Saves input-dark-subtracted.[ge2 | tiff] # subtract_dark input.[ge2 | tiff] dark_image.[ge2 | tiff] # 7. Show FF data in a parent directory. This lists all ge2 files inside # subdirectories. The output format is such that the GE2 list can be # used e.g. in a heXRD config file. # show_ff_data path/to/parent/directory # # Convert TIFF/PNG etc to GE2 (single or multi frame, works on multiple files) function tiff2ge() { for var in &quot;$@&quot; do echo &quot;Processing : tiff2ge : $var&quot; filename=$(basename &quot;$var&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; convert &quot;$var&quot; -endian LSB -depth 16 -size 2048x2048 gray:&quot;$filename&quot;.ge2.tmp dd if=&quot;$filename&quot;.ge2.tmp of=&quot;$filename&quot;.ge2 obs=8192 seek=1 rm -f &quot;$filename.ge2.tmp&quot; done } # Convert GE2 image to tiff function ge2tiff() { for var in &quot;$@&quot; do echo &quot;Processing : ge2tiff : $var&quot; filename=$(basename &quot;$var&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; convert -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$var&quot; &quot;$filename&quot;.tiff done } # Max over all frames function max_over_frames() { for var in &quot;$@&quot; do filename=$(basename &quot;$var&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; if [ ${extension^^} == &quot;TIF&quot; ] || [ ${extension^^} == &quot;TIFF&quot; ] then echo &quot;Processing : max over : $extension : $var&quot; convert &quot;$var&quot; -evaluate-sequence max &quot;$filename&quot;-max.&quot;$extension&quot; elif [ ${extension^^} == &quot;GE2&quot; ] then echo &quot;Processing : max over : $extension : $var&quot; convert -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$var&quot; \ -endian LSB -depth 16 -size 2048x2048 -evaluate-sequence max gray:&quot;$filename&quot;.&quot;$extension&quot;.max dd if=&quot;$filename&quot;.&quot;$extension&quot;.max of=&quot;$filename&quot;-max.&quot;$extension&quot; obs=8192 seek=1 rm -f &quot;$filename&quot;.&quot;$extension&quot;.max fi done } # Mean over all frames function mean_over_frames() { for var in &quot;$@&quot; do filename=$(basename &quot;$var&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; if [ ${extension^^} == &quot;TIF&quot; ] || [ ${extension^^} == &quot;TIFF&quot; ] then echo &quot;Processing : max over : $extension : $var&quot; convert &quot;$var&quot; -evaluate-sequence mean &quot;$filename&quot;-mean.&quot;$extension&quot; elif [ ${extension^^} == &quot;GE2&quot; ] then echo &quot;Processing : max over : $extension : $var&quot; convert -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$var&quot; \ -endian LSB -depth 16 -size 2048x2048 -evaluate-sequence mean gray:&quot;$filename&quot;.&quot;$extension&quot;.mean dd if=&quot;$filename&quot;.&quot;$extension&quot;.mean of=&quot;$filename&quot;-mean.&quot;$extension&quot; obs=8192 seek=1 rm -f &quot;$filename&quot;.&quot;$extension&quot;.mean fi done } # Extract a specific frame from multi-frame image function extract_frame() { filename=$(basename &quot;$1&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; if [ ${extension^^} == &quot;TIF&quot; ] || [ ${extension^^} == &quot;TIFF&quot; ] then echo &quot;Processing : extract frame $2 : $extension : $1&quot; convert &quot;$1&quot;[$2] &quot;$filename&quot;_&quot;$2&quot;.&quot;$extension&quot; elif [ ${extension^^} == &quot;GE2&quot; ] then echo &quot;Processing : extract frame $2 : $extension : $1&quot; convert -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$1&quot;[&quot;$2&quot;] \ -endian LSB -depth 16 -size 2048x2048 -evaluate-sequence max gray:&quot;$filename&quot;_&quot;$2&quot;.&quot;$extension&quot;.tmp dd if=&quot;$filename&quot;_&quot;$2&quot;.&quot;$extension&quot;.tmp of=&quot;$filename&quot;_&quot;$2&quot;.&quot;$extension&quot; obs=8192 seek=1 rm -f &quot;$filename&quot;_&quot;$2&quot;.&quot;$extension&quot;.tmp fi } # Subtract a dark frame from an image (not tested for multiframe) function subtract_dark() { filename=$(basename &quot;$1&quot;) extension=&quot;${filename##*.}&quot; filename=&quot;${filename%.*}&quot; if [ ${extension^^} == &quot;TIF&quot; ] || [ ${extension^^} == &quot;TIFF&quot; ] then echo &quot;Processing : subtract dark : $extension : $2 from $1&quot; convert $1 null: $2 -compose difference -layers composite &quot;$filename&quot;-dark-subtracted.&quot;$extension&quot; #composite -compose difference $1 $2 &quot;$filename&quot;-dark-subtracted.&quot;$extension&quot; elif [ ${extension^^} == &quot;GE2&quot; ] then echo &quot;Processing : subtract dark : $extension : $2 from $1&quot; convert -endian LSB -depth 16 -size 2048x2048+8192 gray:$1 \ -endian LSB -depth 16 -size 2048x2048+8192 null: gray:$2 \ -compose difference -layers composite -endian LSB -depth 16 -size 2048x2048+8192 &quot;$filename&quot;-dark-subtracted.&quot;$extension&quot;.tmp #composite -compose difference -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$1&quot; \ # -endian LSB -depth 16 -size 2048x2048+8192 gray:&quot;$2&quot; \ # -endian LSB -depth 16 -size 2048x2048+8192 &quot;$filename&quot;-dark-subtracted.&quot;$extension&quot;.tmp dd if=&quot;$filename&quot;-dark-subtracted.&quot;$extension&quot;.tmp of=&quot;$filename&quot;-dark-subtracted.&quot;$extension&quot; obs=8192 seek=1 rm -f &quot;$filename&quot;-dark-subtracted.&quot;$extension&quot;.tmp fi } # Display file numbers from an ff directory function show_ff_data() { # Find all directories with name ff and loop over them find &quot;$@&quot; -not -empty -name &quot;ff&quot; -print | while read f; do # Show directory name echo &quot;$f&quot; # Get size of all contents in the directory (in bytes) tot_byte_size=$(du -b &quot;$f&quot;) # By default du prints the folder name too. Strip that. tot_byte_size=($tot_byte_size) tot_byte_size=${tot_byte_size[0]} # Estimate number of FF frames assuming one frame = 2048*2048*2 bytes num_frames_estimate=$( echo $tot_byte_size / 8388608 | bc ) # Get size of all contents in a human readable unit (M, G, T) tot_file_size=$(du -h &quot;$f&quot;) tot_file_size=($tot_file_size) # Print total size and frame number estimate echo Total size = ${tot_file_size[0]}, Estimated frames = $num_frames_estimate # List the contents of the folders filenames1=$(eval ls \&#39;&quot;$f&quot;\&#39; | tr &#39;\n&#39; &#39; &#39;) filelist=&#39;&#39; # Clean up the filenames assuming ff_%5d.ge2 format for filename in $filenames1 do filenum1=${filename:3:5} filenum=$(echo $filenum1 | sed &#39;s/^0*//&#39;) filelist+=&quot;, $filenum&quot; done filelist1=${filelist:2} # Print comma separated list of file numbers echo $filelist1 done } </pre></noscript><script src=https://gist.github.com/hmparanjape/ef50c999d7fd69c3e996.js></script></div></div><div class=row><div class="col-md-10 hp-blog-post-tail"><div class=hp-blog-subtitle><ul class="list-inline hp-blog-subtitle-item"><li class=hp-blog-category>science</li><li class=hp-blog-category>how-to</li></ul><div class="hp-blog-share-buttons pull-right hp-blog-subtitle-item"><a href="https://twitter.com/intent/tweet?text=Processing GE2 Diffraction Images using ImageMagick&url=https://www.harshadparanjape.com/2015/08/31/ge.html&via=&related=" rel=nofollow target=_blank title="Share on Twitter">Twitter</a> <a href="https://facebook.com/sharer.php?u=https://www.harshadparanjape.com/2015/08/31/ge.html" rel=nofollow target=_blank title="Share on Facebook">Facebook</a> <a href="mailto:?Subject=Interesting blog article&amp;Body=I%20saw%20this%20and%20thought%20you%20would%20like%20it!%20 - https://www.harshadparanjape.com/2015/08/31/ge.html">Email</a></div></div></div></div><div class="row hp-blog-tail-helper-row"><div class="col-md-5 col-xs-6"><a href=../../../blog.html class=hp-blog-tail-helper>Return to blog</a></div><div class="col-md-5 col-xs-6 text-right"><a href=#hp-blog-empty-top class="hp-blog-scrollup hp-blog-tail-helper">Back to top</a></div></div><!-- Footer --><div class="row hp-footer"><div class=col-xs-12><p class="text-center hp-footer-content">&copy; 2022, Harshad Paranjape</p></div></div></div><!-- /.container --><script src=../../../js/script.js></script></body></html>